<div class="addresses-container">
  <div class="addresses-header">
    <h2>My Addresses</h2>
    <p>Manage your delivery addresses</p>
    <button class="btn btn-primary" (click)="openAddAddressModal()">
      <i class="fas fa-plus"></i>
      Add New Address
    </button>
  </div>

  <div class="addresses-content" *ngIf="!isLoading">
    <div class="empty-state" *ngIf="addresses.length === 0">
      <div class="empty-icon">
        <i class="fas fa-map-marker-alt"></i>
      </div>
      <h3>No Saved Addresses</h3>
      <p>Add your first delivery address to make ordering easier</p>
      <button class="btn btn-primary" (click)="openAddAddressModal()">
        <i class="fas fa-plus"></i>
        Add New Address
      </button>
    </div>

    <div class="addresses-grid" *ngIf="addresses.length > 0">
      <div class="address-card" *ngFor="let address of addresses" [class.default]="address.isDefault">
        <div class="card-header">
          <div class="address-type">
            <i [class]="getAddressIcon(address.type || 'home')"></i>
            <span>{{ getAddressTypeText(address.type || 'home') }}</span>
          </div>
          <div class="card-actions">
            <button class="action-btn" (click)="editAddress(address)">
              <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn delete" (click)="deleteAddress(address._id || '')">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <div class="card-content">
          <div class="address-details">
            <h4>{{ address.label || getAddressTypeText(address.type || 'home') }}</h4>
            <p class="address-text">
              {{ address.street }}, {{ address.building }}
              <span *ngIf="address.floor">, Floor {{ address.floor }}</span>
              <span *ngIf="address.apartment">, Apartment {{ address.apartment }}</span>
            </p>
            <p class="area-text">{{ address.area }}, {{ address.city }}</p>
            <p class="phone-text" *ngIf="address.phone">
              <i class="fas fa-phone"></i>
              {{ address.phone }}
            </p>
            <p class="notes-text" *ngIf="address.notes">
              <i class="fas fa-sticky-note"></i>
              {{ address.notes }}
            </p>
          </div>

          <div class="card-footer">
            <button class="btn btn-outline" *ngIf="!address.isDefault" (click)="setDefaultAddress(address._id || '')">
              <i class="fas fa-star"></i>
              Set as Default
            </button>
            <div class="default-badge" *ngIf="address.isDefault">
              <i class="fas fa-star"></i>
              Default Address
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-state" *ngIf="isLoading">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Loading addresses...</p>
  </div>
</div>

<!-- Add/Edit Address Modal -->
<div class="modal-overlay" *ngIf="showAddressModal" (click)="closeAddressModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ isEditMode ? 'Edit Address' : 'Add New Address' }}</h3>
      <button class="close-btn" (click)="closeAddressModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <form [formGroup]="addressForm" (ngSubmit)="onSubmitAddress()" class="address-form">
      <div class="modal-body">
        <div class="form-row">
          <div class="form-group">
            <label for="type">Address Type</label>
            <select id="type" formControlName="type" class="form-control">
              <option value="home">Home</option>
              <option value="work">Work</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group" *ngIf="addressForm.get('type')?.value === 'other'">
            <label for="label">Address Label</label>
            <input id="label" formControlName="label" type="text" class="form-control" placeholder="e.g: Gym, School" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="city">City</label>
            <select id="city" formControlName="city" class="form-control">
              <option value="">Select City</option>
              <option value="Riyadh">Riyadh</option>
              <option value="Jeddah">Jeddah</option>
              <option value="Dammam">Dammam</option>
              <option value="Mecca">Mecca</option>
              <option value="Medina">Medina</option>
            </select>
            <div class="error-message" *ngIf="addressForm.get('city')?.invalid && addressForm.get('city')?.touched">
              City is required
            </div>
          </div>
          <div class="form-group">
            <label for="area">Area/District</label>
            <input id="area" formControlName="area" type="text" class="form-control"
              placeholder="Neighborhood or area name" />
            <div class="error-message" *ngIf="addressForm.get('area')?.invalid && addressForm.get('area')?.touched">
              Area is required
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="street">Street</label>
          <input id="street" formControlName="street" type="text" class="form-control"
            placeholder="Street or road name" />
          <div class="error-message" *ngIf="addressForm.get('street')?.invalid && addressForm.get('street')?.touched">
            Street is required
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="building">Building Number</label>
            <input id="building" formControlName="building" type="text" class="form-control"
              placeholder="Building or villa number" />
            <div class="error-message"
              *ngIf="addressForm.get('building')?.invalid && addressForm.get('building')?.touched">
              Building number is required
            </div>
          </div>
          <div class="form-group">
            <label for="floor">Floor (Optional)</label>
            <input id="floor" formControlName="floor" type="text" class="form-control" placeholder="Floor number" />
          </div>
          <div class="form-group">
            <label for="apartment">Apartment Number (Optional)</label>
            <input id="apartment" formControlName="apartment" type="text" class="form-control"
              placeholder="Apartment or office number" />
          </div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input id="phone" formControlName="phone" type="tel" class="form-control" placeholder="05xxxxxxxx" />
          <div class="error-message" *ngIf="addressForm.get('phone')?.invalid && addressForm.get('phone')?.touched">
            <div *ngIf="addressForm.get('phone')?.errors?.['required']">Phone number is required</div>
            <div *ngIf="addressForm.get('phone')?.errors?.['pattern']">Invalid phone number</div>
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Additional Notes (Optional)</label>
          <textarea id="notes" formControlName="notes" class="form-control" rows="3"
            placeholder="Delivery instructions or other notes"></textarea>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isDefault" />
            <span class="checkmark"></span>
            Set as default address
          </label>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" (click)="closeAddressModal()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="addressForm.invalid || isSubmitting">
          <i class="fas fa-spinner fa-spin" *ngIf="isSubmitting"></i>
          {{ isSubmitting ? 'Saving...' : (isEditMode ? 'Update' : 'Save') }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Delete confirmation modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Delete Address</h3>
      <button class="close-btn" (click)="cancelDelete()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this address? This action cannot be undone.</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
      <button class="btn btn-danger" (click)="confirmDelete()">
        <i class="fas fa-trash"></i>
        Delete
      </button>
    </div>
  </div>
</div>