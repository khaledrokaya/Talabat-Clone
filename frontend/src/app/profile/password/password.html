<div class="password-container">
  <div class="password-header">
    <h2>Change Password</h2>
    <p>Update your password to keep your account secure</p>
  </div>

  <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form">
    <div class="form-group">
      <label for="currentPassword">Current Password</label>
      <div class="password-input-wrapper">
        <input id="currentPassword" formControlName="currentPassword" [type]="showCurrentPassword ? 'text' : 'password'"
          class="form-control" placeholder="Enter your current password" />
        <button type="button" class="password-toggle" (click)="toggleCurrentPassword()">
          <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      <div class="error-message"
        *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
        Current password is required
      </div>
    </div>

    <div class="form-group">
      <label for="newPassword">New Password</label>
      <div class="password-input-wrapper">
        <input id="newPassword" formControlName="newPassword" [type]="showNewPassword ? 'text' : 'password'"
          class="form-control" placeholder="Enter your new password" />
        <button type="button" class="password-toggle" (click)="toggleNewPassword()">
          <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      <div class="password-strength" *ngIf="passwordForm.get('newPassword')?.value">
        <div class="strength-bar">
          <div class="strength-fill" [ngClass]="passwordStrength.class" [style.width.%]="passwordStrength.percentage">
          </div>
        </div>
        <span class="strength-text" [ngClass]="passwordStrength.class">{{ passwordStrength.text }}</span>
      </div>
      <div class="error-message"
        *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
        <div *ngIf="passwordForm.get('newPassword')?.errors?.['required']">New password is required</div>
        <div *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 8 characters</div>
        <div *ngIf="passwordForm.get('newPassword')?.errors?.['pattern']">Password must contain letters and numbers
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="confirmPassword">Confirm New Password</label>
      <div class="password-input-wrapper">
        <input id="confirmPassword" formControlName="confirmPassword" [type]="showConfirmPassword ? 'text' : 'password'"
          class="form-control" placeholder="Re-enter your new password" />
        <button type="button" class="password-toggle" (click)="toggleConfirmPassword()">
          <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
        </button>
      </div>
      <div class="error-message"
        *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
        <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Password confirmation is required</div>
        <div *ngIf="passwordForm.get('confirmPassword')?.errors?.['mismatch']">Passwords do not match</div>
      </div>
    </div>

    <div class="password-requirements">
      <h4>Password Requirements:</h4>
      <ul>
        <li [ngClass]="{'valid': passwordRequirements.length}">
          <i class="fas fa-check"></i>
          At least 8 characters
        </li>
        <li [ngClass]="{'valid': passwordRequirements.uppercase}">
          <i class="fas fa-check"></i>
          At least one uppercase letter
        </li>
        <li [ngClass]="{'valid': passwordRequirements.lowercase}">
          <i class="fas fa-check"></i>
          At least one lowercase letter
        </li>
        <li [ngClass]="{'valid': passwordRequirements.number}">
          <i class="fas fa-check"></i>
          At least one number
        </li>
      </ul>
    </div>

    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="passwordForm.invalid || isLoading">
        <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
        {{ isLoading ? 'Updating...' : 'Update Password' }}
      </button>
    </div>
  </form>
</div>