<div class="orders-management">
  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="page-title">
          <i class="fas fa-chart-bar"></i>
          Order Statistics
        </h2>
        <p class="page-subtitle">View comprehensive order analytics and performance metrics</p>
      </div>
      <div class="header-actions">
        <div class="filter-dropdown me-2">
          <select class="form-select" [(ngModel)]="timeFilter" (ngModelChange)="onTimeFilterChange()">
            <option *ngFor="let option of timeFilterOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
        <button class="btn btn-primary" (click)="refreshStats()" [disabled]="isLoading">
          <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible">
    <i class="fas fa-exclamation-triangle"></i>
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading order statistics...</p>
    </div>
  </div>

  <!-- Statistics Dashboard -->
  <div *ngIf="!isLoading" class="stats-dashboard">

    <!-- Primary Stats Cards -->
    <div class="stats-section">
      <h5 class="section-title">
        <i class="fas fa-chart-line"></i>
        Overview Statistics
        <span class="badge bg-primary ms-2">{{ getCurrentTimeLabel() }}</span>
      </h5>
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.totalOrders) }}</div>
          <div class="stat-label">Total Orders</div>
        </div>

        <div class="stat-card success">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatCurrency(orderStats.totalRevenue) }}</div>
          <div class="stat-label">Total Revenue</div>
        </div>

        <div class="stat-card info">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-calculator"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatCurrency(orderStats.avgOrderValue) }}</div>
          <div class="stat-label">Average Order Value</div>
        </div>

        <div class="stat-card warning">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.activeOrders) }}</div>
          <div class="stat-label">Active Orders</div>
        </div>
      </div>
    </div>

    <!-- Order Status Breakdown -->
    <div class="stats-section">
      <h5 class="section-title">
        <i class="fas fa-chart-pie"></i>
        Order Status Breakdown
      </h5>
      <div class="stats-grid">
        <div class="stat-card pending">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-hourglass-half"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.pendingOrders) }}</div>
          <div class="stat-label">Pending Orders</div>
        </div>

        <div class="stat-card completed">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.completedOrders) }}</div>
          <div class="stat-label">Completed Orders</div>
        </div>

        <div class="stat-card cancelled">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-times-circle"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.cancelledOrders) }}</div>
          <div class="stat-label">Cancelled Orders</div>
        </div>

        <div class="stat-card rate">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-percentage"></i>
            </div>
          </div>
          <div class="stat-value">{{ getCompletionRate().toFixed(1) }}%</div>
          <div class="stat-label">Completion Rate</div>
        </div>
      </div>
    </div>

    <!-- Performance Metrics -->
    <div class="stats-section">
      <h5 class="section-title">
        <i class="fas fa-tachometer-alt"></i>
        Performance Metrics
      </h5>
      <div class="stats-grid">
        <div class="stat-card daily">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-calendar-day"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.ordersToday) }}</div>
          <div class="stat-label">Orders Today</div>
          <div class="stat-sublabel">{{ formatCurrency(orderStats.revenueToday) }} revenue</div>
        </div>

        <div class="stat-card monthly">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-calendar-alt"></i>
            </div>
          </div>
          <div class="stat-value">{{ formatNumber(orderStats.monthlyOrders) }}</div>
          <div class="stat-label">Monthly Orders</div>
          <div class="stat-sublabel">{{ formatCurrency(orderStats.monthlyRevenue) }} revenue</div>
        </div>

        <div class="stat-card top-restaurant">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-crown"></i>
            </div>
          </div>
          <div class="stat-value-text">{{ orderStats.topRestaurant }}</div>
          <div class="stat-label">Top Restaurant</div>
          <div class="stat-sublabel">Most orders this period</div>
        </div>

        <div class="stat-card cancel-rate">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
          </div>
          <div class="stat-value">{{ getCancellationRate().toFixed(1) }}%</div>
          <div class="stat-label">Cancellation Rate</div>
          <div class="stat-sublabel">{{ formatNumber(orderStats.cancelledOrders) }} cancelled</div>
        </div>
      </div>
    </div>
  </div>
</div>