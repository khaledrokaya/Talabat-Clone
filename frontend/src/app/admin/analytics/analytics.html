<div class="analytics-dashboard">
  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="page-title">
          <i class="fas fa-chart-line"></i>
          Analytics Dashboard
        </h2>
        <p class="page-subtitle">Monitor business performance and insights</p>
      </div>
      <div class="header-actions">
        <select class="form-select period-selector" [(ngModel)]="selectedPeriod" (change)="onPeriodChange()">
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="quarter">This Quarter</option>
          <option value="year">This Year</option>
        </select>
        <button class="btn btn-primary" (click)="refreshData()" [disabled]="isLoading">
          <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading analytics data...</p>
    </div>
  </div>

  <!-- Analytics Content -->
  <div *ngIf="!isLoading && analytics" class="analytics-content">
    <!-- KPI Cards -->
    <div class="kpi-section">
      <div class="row g-3">
        <div class="col-lg-3 col-md-6">
          <div class="kpi-card revenue">
            <div class="kpi-icon">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="kpi-content">
              <h3 class="kpi-value">${{ formatNumber(analytics.revenue.total) }}</h3>
              <p class="kpi-label">Total Revenue</p>
              <div class="kpi-change" [class.positive]="analytics.revenue.change >= 0"
                [class.negative]="analytics.revenue.change < 0">
                <i [class]="analytics.revenue.change >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                {{ Math.abs(analytics.revenue.change) }}%
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="kpi-card orders">
            <div class="kpi-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="kpi-content">
              <h3 class="kpi-value">{{ formatNumber(analytics.orders.total) }}</h3>
              <p class="kpi-label">Total Orders</p>
              <div class="kpi-change" [class.positive]="analytics.orders.change >= 0"
                [class.negative]="analytics.orders.change < 0">
                <i [class]="analytics.orders.change >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                {{ Math.abs(analytics.orders.change) }}%
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="kpi-card users">
            <div class="kpi-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="kpi-content">
              <h3 class="kpi-value">{{ formatNumber(analytics.users.total) }}</h3>
              <p class="kpi-label">Active Users</p>
              <div class="kpi-change" [class.positive]="analytics.users.change >= 0"
                [class.negative]="analytics.users.change < 0">
                <i [class]="analytics.users.change >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                {{ Math.abs(analytics.users.change) }}%
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="kpi-card restaurants">
            <div class="kpi-icon">
              <i class="fas fa-utensils"></i>
            </div>
            <div class="kpi-content">
              <h3 class="kpi-value">{{ formatNumber(analytics.restaurants.total) }}</h3>
              <p class="kpi-label">Active Restaurants</p>
              <div class="kpi-change" [class.positive]="analytics.restaurants.change >= 0"
                [class.negative]="analytics.restaurants.change < 0">
                <i [class]="analytics.restaurants.change >= 0 ? 'fas fa-arrow-up' : 'fas fa-arrow-down'"></i>
                {{ Math.abs(analytics.restaurants.change) }}%
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="row g-4">
        <!-- Revenue Chart -->
        <div class="col-lg-8">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Revenue Trend</h5>
              <div class="chart-controls">
                <button class="btn btn-sm" [class.btn-primary]="revenueChartType === 'line'"
                  [class.btn-outline-primary]="revenueChartType !== 'line'" (click)="revenueChartType = 'line'">
                  Line
                </button>
                <button class="btn btn-sm" [class.btn-primary]="revenueChartType === 'bar'"
                  [class.btn-outline-primary]="revenueChartType !== 'bar'" (click)="revenueChartType = 'bar'">
                  Bar
                </button>
              </div>
            </div>
            <div class="chart-content">
              <canvas #revenueChart width="400" height="200"></canvas>
            </div>
          </div>
        </div>

        <!-- Order Status Chart -->
        <div class="col-lg-4">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Order Status Distribution</h5>
            </div>
            <div class="chart-content">
              <canvas #orderStatusChart width="300" height="200"></canvas>
            </div>
          </div>
        </div>

        <!-- Top Restaurants -->
        <div class="col-lg-6">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Top Performing Restaurants</h5>
            </div>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Restaurant</th>
                    <th>Orders</th>
                    <th>Revenue</th>
                    <th>Rating</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let restaurant of analytics.topRestaurants; let i = index">
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="rank-badge">{{ i + 1 }}</span>
                        <span class="restaurant-name">{{ restaurant.name }}</span>
                      </div>
                    </td>
                    <td>{{ formatNumber(restaurant.orders) }}</td>
                    <td>${{ formatNumber(restaurant.revenue) }}</td>
                    <td>
                      <div class="rating">
                        <span class="rating-value">{{ restaurant.rating }}</span>
                        <div class="stars">
                          <i *ngFor="let star of getStars(restaurant.rating)" [class]="star"></i>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Geographic Distribution -->
        <div class="col-lg-6">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Orders by Location</h5>
            </div>
            <div class="location-stats">
              <div *ngFor="let location of analytics.locationStats" class="location-item">
                <div class="location-info">
                  <span class="location-name">{{ location.city }}</span>
                  <span class="location-count">{{ formatNumber(location.orders) }} orders</span>
                </div>
                <div class="location-bar">
                  <div class="location-fill" [style.width.%]="getLocationPercentage(location.orders)"></div>
                </div>
                <span class="location-percentage">{{ getLocationPercentage(location.orders) }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-lg-6">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Recent Activity</h5>
            </div>
            <div class="activity-feed">
              <div *ngFor="let activity of analytics.recentActivity" class="activity-item">
                <div class="activity-icon" [class]="getActivityIconClass(activity.type)">
                  <i [class]="getActivityIcon(activity.type)"></i>
                </div>
                <div class="activity-content">
                  <p class="activity-text">{{ activity.description }}</p>
                  <small class="activity-time">{{ formatDate(activity.timestamp) }}</small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Performance Metrics -->
        <div class="col-lg-6">
          <div class="chart-card">
            <div class="chart-header">
              <h5>Performance Metrics</h5>
            </div>
            <div class="metrics-grid">
              <div class="metric-item">
                <div class="metric-label">Average Order Value</div>
                <div class="metric-value">${{ analytics.performanceMetrics.averageOrderValue }}</div>
                <div class="metric-change positive">
                  <i class="fas fa-arrow-up"></i>
                  {{ analytics.performanceMetrics.aovChange }}%
                </div>
              </div>

              <div class="metric-item">
                <div class="metric-label">Delivery Time</div>
                <div class="metric-value">{{ analytics.performanceMetrics.averageDeliveryTime }} min</div>
                <div class="metric-change negative">
                  <i class="fas fa-arrow-down"></i>
                  {{ analytics.performanceMetrics.deliveryTimeChange }}%
                </div>
              </div>

              <div class="metric-item">
                <div class="metric-label">Customer Satisfaction</div>
                <div class="metric-value">{{ analytics.performanceMetrics.customerSatisfaction }}%</div>
                <div class="metric-change positive">
                  <i class="fas fa-arrow-up"></i>
                  {{ analytics.performanceMetrics.satisfactionChange }}%
                </div>
              </div>

              <div class="metric-item">
                <div class="metric-label">Order Accuracy</div>
                <div class="metric-value">{{ analytics.performanceMetrics.orderAccuracy }}%</div>
                <div class="metric-change positive">
                  <i class="fas fa-arrow-up"></i>
                  {{ analytics.performanceMetrics.accuracyChange }}%
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary Stats -->
    <div class="summary-section">
      <div class="row g-4">
        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="summary-content">
              <h4>{{ analytics.summary.peakHour }}</h4>
              <p>Peak Hour</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-icon">
              <i class="fas fa-calendar-day"></i>
            </div>
            <div class="summary-content">
              <h4>{{ analytics.summary.peakDay }}</h4>
              <p>Peak Day</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-icon">
              <i class="fas fa-hamburger"></i>
            </div>
            <div class="summary-content">
              <h4>{{ analytics.summary.topCuisine }}</h4>
              <p>Top Cuisine</p>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="summary-card">
            <div class="summary-icon">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="summary-content">
              <h4>{{ analytics.summary.topPaymentMethod }}</h4>
              <p>Top Payment Method</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!isLoading && !analytics" class="error-state">
    <div class="text-center py-5">
      <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
      <h5 class="text-muted">Unable to load analytics data</h5>
      <p class="text-muted">Please try refreshing the page or contact support if the issue persists.</p>
      <button class="btn btn-primary" (click)="refreshData()">
        <i class="fas fa-sync"></i>
        Try Again
      </button>
    </div>
  </div>
</div>