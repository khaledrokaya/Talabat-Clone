<div class="restaurants-management">
  <!-- Enhanced Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-info">
        <h1>
          <i class="fas fa-utensils"></i>
          Restaurants Management
        </h1>
        <p>Review and manage restaurant applications and existing establishments</p>
        <div class="quick-stats">
          <div class="stat-item">
            <span class="stat-value">{{ getRestaurantStats().total }}</span>
            <span class="stat-label">Total Restaurants</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ getRestaurantStats().pending }}</span>
            <span class="stat-label">Pending Approval</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ getRestaurantStats().approved }}</span>
            <span class="stat-label">Approved Restaurants</span>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-outline-primary" (click)="loadPendingRestaurants()" [disabled]="isLoading">
          <i class="fas fa-download"></i>
          Export Data
        </button>
        <button class="btn btn-primary" (click)="loadPendingRestaurants()" [disabled]="isLoading">
          <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
          Refresh Data
        </button>
      </div>
    </div>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="alert alert-success alert-dismissible">
    <i class="fas fa-check-circle"></i>
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>

  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible">
    <i class="fas fa-exclamation-triangle"></i>
    {{ errorMessage }}
    <button type="button" class="btn-close" (click)="clearMessages()"></button>
  </div>

  <!-- Enhanced Filters Section -->
  <div class="filters-section">
    <div class="filters-card">
      <div class="filters-header">
        <h3><i class="fas fa-filter"></i> Search & Filter Restaurants</h3>
        <button class="btn btn-sm btn-outline-secondary" (click)="onSearchChange()">
          <i class="fas fa-times"></i>
          Clear All
        </button>
      </div>

      <div class="filters-content">
        <div class="filters-grid">
          <div class="filter-group">
            <label class="filter-label">Search Restaurants</label>
            <div class="search-input">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="Search by name, email, or restaurant name..." [(ngModel)]="searchTerm"
                (ngModelChange)="onSearchChange()" />
            </div>
          </div>

          <div class="filter-group">
            <label class="filter-label">Status Filter</label>
            <select class="filter-select" [(ngModel)]="searchTerm" (change)="onSearchChange()">
              <option value="">All Statuses</option>
              <option value="pending">Pending Approval</option>
              <option value="verified">Verified</option>
              <option value="rejected">Rejected</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Items Per Page</label>
            <select class="filter-select" [(ngModel)]="pageSize" (change)="onSearchChange()">
              <option value="10">10 per page</option>
              <option value="25">25 per page</option>
              <option value="50">50 per page</option>
              <option value="100">100 per page</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Sort By</label>
            <select class="filter-select" [(ngModel)]="searchTerm" (change)="onSearchChange()">
              <option value="createdAt">Application Date</option>
              <option value="name">Restaurant Name</option>
              <option value="owner">Owner Name</option>
              <option value="status">Status</option>
            </select>
          </div>
        </div>

        <div class="filters-summary">
          <div class="summary-item">
            <i class="fas fa-info-circle"></i>
            <span>Showing {{ filteredRestaurants.length }} of {{ getRestaurantStats().total }} restaurants</span>
            <span *ngIf="currentPage > 1" class="page-info">â€¢ Page {{ currentPage }} of {{ totalPages }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h3>Loading restaurants...</h3>
      <p>Please wait while we fetch the restaurant data</p>
    </div>
  </div>

  <!-- Restaurants Grid -->
  <div class="restaurants-grid" *ngIf="!isLoading && filteredRestaurants.length > 0">
    <div class="grid-container">
      <div class="restaurant-card" *ngFor="let restaurant of getPaginatedRestaurants(); trackBy: trackByRestaurant">
        <!-- Restaurant Header -->
        <div class="restaurant-header">
          <div class="restaurant-avatar">
            {{ getRestaurantName(restaurant).charAt(0).toUpperCase() }}
          </div>
          <div class="restaurant-info">
            <h5 class="restaurant-name">{{ getRestaurantName(restaurant) }}</h5>
            <p class="owner-name">{{ getOwnerName(restaurant) }}</p>
            <div class="status-badges">
              <span class="status-badge"
                [ngClass]="'badge bg-' + (restaurant.status === 'pending' ? 'warning' : restaurant.status === 'verified' ? 'success' : 'danger')">
                <i
                  [class]="'fas fa-' + (restaurant.status === 'pending' ? 'clock' : restaurant.status === 'verified' ? 'check' : 'times')"></i>
                {{ restaurant.status | titlecase }}
              </span>
            </div>
          </div>
        </div>

        <!-- Restaurant Details -->
        <div class="restaurant-details">
          <div class="detail-item">
            <i class="fas fa-envelope"></i>
            <span>{{ restaurant.email || 'N/A' }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-phone"></i>
            <span>{{ restaurant.phone || 'N/A' }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>{{ getRestaurantAddress(restaurant) }}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-clock"></i>
            <span>Applied: {{ formatDate(getCreatedDate(restaurant)) }}</span>
          </div>
        </div>

        <!-- Business License -->
        <div class="business-info" *ngIf="getBusinessLicense(restaurant)">
          <div class="detail-item">
            <i class="fas fa-certificate"></i>
            <span>License: {{ getBusinessLicense(restaurant) }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="restaurant-actions">
          <button class="btn btn-sm btn-outline-primary" (click)="viewRestaurant(restaurant)" title="View Details">
            <i class="fas fa-eye"></i>
            View
          </button>

          <button *ngIf="restaurant.status === 'pending'" class="btn btn-sm btn-success"
            (click)="approveRestaurant(restaurant)" title="Approve Restaurant">
            <i class="fas fa-check"></i>
            Approve
          </button>

          <button *ngIf="restaurant.status === 'pending'" class="btn btn-sm btn-warning"
            (click)="rejectRestaurant(restaurant)" title="Reject Restaurant">
            <i class="fas fa-times"></i>
            Reject
          </button>

          <button *ngIf="restaurant.status === 'verified'" class="btn btn-sm btn-secondary"
            (click)="viewRestaurant(restaurant)" title="Deactivate Restaurant">
            <i class="fas fa-pause"></i>
            Deactivate
          </button>

          <button *ngIf="restaurant.status === 'rejected'" class="btn btn-sm btn-success"
            (click)="viewRestaurant(restaurant)" title="Activate Restaurant">
            <i class="fas fa-play"></i>
            Activate
          </button>

          <button class="btn btn-sm btn-outline-danger" (click)="deleteRestaurant(restaurant)"
            title="Delete Restaurant">
            <i class="fas fa-trash"></i>
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-section" *ngIf="totalPages > 1">
      <div class="pagination-info">
        <span>Showing {{ (currentPage - 1) * pageSize + 1 }} to {{ currentPage * pageSize > filteredRestaurants.length ?
          filteredRestaurants.length : currentPage * pageSize }} of {{ filteredRestaurants.length }} restaurants</span>
      </div>
      <nav class="pagination">
        <button class="page-btn" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)">
          <i class="fas fa-chevron-left"></i>
        </button>

        <button *ngFor="let page of generatePageNumbers()" class="page-btn" [class.active]="page === currentPage"
          (click)="onPageChange(page)">
          {{ page }}
        </button>

        <button class="page-btn" [disabled]="currentPage === totalPages" (click)="onPageChange(currentPage + 1)">
          <i class="fas fa-chevron-right"></i>
        </button>
      </nav>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredRestaurants.length === 0" class="empty-state">
    <div class="empty-content">
      <i class="fas fa-utensils empty-icon"></i>
      <h3>No Restaurants Found</h3>
      <p>There are no restaurants matching your current filters.</p>
      <button class="btn btn-primary" (click)="onSearchChange()">
        <i class="fas fa-times"></i>
        Clear Filters
      </button>
    </div>
  </div>
</div>

<!-- Restaurant Details Modal -->
<div class="modal" [class.show]="showRestaurantModal" [style.display]="showRestaurantModal ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-utensils"></i>
          Restaurant Details
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body" *ngIf="currentRestaurant">
        <div class="restaurant-profile">
          <div class="profile-header">
            <div class="restaurant-avatar-large">
              {{ getRestaurantName(currentRestaurant).charAt(0).toUpperCase() }}
            </div>
            <div class="profile-info">
              <h3>{{ getRestaurantName(currentRestaurant) }}</h3>
              <p class="owner-info">Owner: {{ getOwnerName(currentRestaurant) }}</p>
              <div class="status-badges">
                <span class="status-badge"
                  [ngClass]="'badge bg-' + (currentRestaurant.status === 'pending' ? 'warning' : currentRestaurant.status === 'verified' ? 'success' : 'danger')">
                  <i
                    [class]="'fas fa-' + (currentRestaurant.status === 'pending' ? 'clock' : currentRestaurant.status === 'verified' ? 'check' : 'times')"></i>
                  {{ currentRestaurant.status | titlecase }}
                </span>
              </div>
            </div>
          </div>

          <div class="profile-details">
            <div class="row">
              <div class="col-md-6">
                <h6>Contact Information</h6>
                <div class="detail-group">
                  <div class="detail-item">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">{{ currentRestaurant.email }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">{{ currentRestaurant.phone }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Address:</span>
                    <span class="detail-value">{{ getRestaurantAddress(currentRestaurant) }}</span>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <h6>Business Information</h6>
                <div class="detail-group">
                  <div class="detail-item" *ngIf="getBusinessLicense(currentRestaurant)">
                    <span class="detail-label">License:</span>
                    <span class="detail-value">{{ getBusinessLicense(currentRestaurant) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Applied:</span>
                    <span class="detail-value">{{ formatDate(getCreatedDate(currentRestaurant)) }}</span>
                  </div>
                  <div class="detail-item">
                    <span class="detail-label">Status:</span>
                    <span class="detail-value">
                      <span class="status-badge"
                        [ngClass]="'badge bg-' + (currentRestaurant.status === 'pending' ? 'warning' : currentRestaurant.status === 'verified' ? 'success' : 'danger')">
                        {{ currentRestaurant.status | titlecase }}
                      </span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
        <button *ngIf="currentRestaurant?.status === 'pending'" type="button" class="btn btn-success"
          (click)="approveRestaurant(currentRestaurant)">
          <i class="fas fa-check"></i>
          Approve
        </button>
        <button *ngIf="currentRestaurant?.status === 'pending'" type="button" class="btn btn-warning"
          (click)="rejectRestaurant(currentRestaurant)">
          <i class="fas fa-times"></i>
          Reject
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Approval Modal -->
<div class="modal" [class.show]="showApprovalModal" [style.display]="showApprovalModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-user-check"></i>
          Restaurant Approval
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <form [formGroup]="approvalForm" (ngSubmit)="submitApproval()">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Action</label>
            <select class="form-select" formControlName="status">
              <option value="verified">Approve</option>
              <option value="rejected">Reject</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Reason/Notes</label>
            <textarea class="form-control" formControlName="reason" rows="3"
              placeholder="Optional reason for your decision..."></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="!approvalForm.valid">
            Submit Decision
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal" [class.show]="showDeleteModal" [style.display]="showDeleteModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="fas fa-exclamation-triangle text-warning"></i>
          Confirm Deletion
        </h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <div class="text-center">
          <i class="fas fa-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
          <h4 class="mt-3">Are you sure?</h4>
          <p class="text-muted">This action cannot be undone. This will permanently delete the restaurant and all
            associated data.</p>
          <div class="alert alert-warning">
            <i class="fas fa-info-circle"></i>
            <strong>Warning:</strong> Deleting a restaurant will remove all their meals, orders, and reviews.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">
          <i class="fas fa-trash"></i>
          Delete Restaurant
        </button>
      </div>
    </div>
  </div>
</div>